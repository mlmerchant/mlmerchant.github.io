<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Submarine Game</title>
</head>
<body>
  <script>
    // Create the game container
    const gameContainer = document.createElement("div");
    gameContainer.style.position = "relative";
    gameContainer.style.width = "800px";
    gameContainer.style.height = "600px";

    // Bright blue sky on top and darker blue underwater on bottom
    gameContainer.style.background = "linear-gradient(to bottom, #1E90FF 50%, #00008B 50%)";

    gameContainer.style.border = "2px solid black";
    gameContainer.style.overflow = "hidden";
    document.body.appendChild(gameContainer);

    // Create the ship at the top
    const ship = document.createElement("div");
    ship.style.position = "absolute";
    // Instead of bottom = 0, we place it near the top
    ship.style.top = "20px";
    ship.style.left = "50%";
    ship.style.width = "80px";
    ship.style.height = "30px";
    ship.style.backgroundColor = "gray";

    // Use clip-path to get a rough "WW2 sub hunter" silhouette
    // Feel free to adjust the polygon to get a shape you like
    ship.style.clipPath = "polygon(0% 100%, 10% 70%, 30% 60%, 70% 60%, 90% 70%, 100% 100%, 100% 100%, 0% 100%)";

    ship.style.transform = "translateX(-50%)";
    gameContainer.appendChild(ship);

    let shipSpeed = 10;
    let activeDepthCharges = 0;
    let depthChargeLimit = 5;
    let score = 0;
    let gameOver = false;
    let subSpawnInterval = 15000;

    // Score display
    const scoreDisplay = document.createElement("div");
    scoreDisplay.style.position = "absolute";
    scoreDisplay.style.top = "10px";
    scoreDisplay.style.left = "10px";
    scoreDisplay.style.fontSize = "20px";
    scoreDisplay.textContent = `Score: ${score}`;
    gameContainer.appendChild(scoreDisplay);

    // Control panel
    const controlPanel = document.createElement("div");
    controlPanel.style.position = "absolute";
    controlPanel.style.top = "10px";
    controlPanel.style.right = "10px";
    controlPanel.style.fontSize = "20px";
    gameContainer.appendChild(controlPanel);

    const startButton = document.createElement("button");
    startButton.textContent = "Start";
    startButton.style.marginRight = "10px";
    controlPanel.appendChild(startButton);

    const resetButton = document.createElement("button");
    resetButton.textContent = "Reset";
    controlPanel.appendChild(resetButton);

    startButton.addEventListener("click", () => {
      if (!gameOver) {
        createSubmarine();
      }
    });

    resetButton.addEventListener("click", () => {
      location.reload();
    });

    // Creates a submarine with a rounded shape
    function createSubmarine() {
      const sub = document.createElement("div");
      sub.style.position = "absolute";
      sub.style.width = "60px";
      sub.style.height = "20px";
      sub.style.backgroundColor = "red";
      // Make it more 'pill-shaped' by rounding corners
      sub.style.borderRadius = "10px";

      // Place the sub somewhere in the bottom half (the underwater region)
      // Adjust the spawn logic as desired
      sub.style.bottom = `${Math.random() * 200 + 300}px`;
      sub.style.left = `${Math.random() > 0.5 ? "0px" : "740px"}`;
      sub.dataset.direction = sub.style.left === "0px" ? "right" : "left";
      gameContainer.appendChild(sub);

      const moveSubmarine = setInterval(() => {
        if (gameOver) {
          clearInterval(moveSubmarine);
          sub.remove();
          return;
        }
        const subLeft = parseInt(sub.style.left);
        if (subLeft <= 0) sub.dataset.direction = "right";
        if (subLeft >= 740) sub.dataset.direction = "left";
        sub.style.left = `${subLeft + (sub.dataset.direction === "right" ? 2 : -2)}px`;

        // Occasionally shoot a bullet upward
        if (Math.random() < 0.01) {
          createBullet(subLeft + 30, parseInt(sub.style.bottom));
        }
      }, 20);
    }

    // Submarine bullet
    function createBullet(x, y) {
      const bullet = document.createElement("div");
      bullet.style.position = "absolute";
      bullet.style.width = "5px";
      bullet.style.height = "10px";
      bullet.style.backgroundColor = "black";
      bullet.style.left = `${x}px`;
      bullet.style.bottom = `${y}px`;
      gameContainer.appendChild(bullet);

      const moveBullet = setInterval(() => {
        if (gameOver) {
          clearInterval(moveBullet);
          bullet.remove();
          return;
        }
        const bulletBottom = parseInt(bullet.style.bottom);
        if (bulletBottom >= 600) {
          clearInterval(moveBullet);
          bullet.remove();
        } else {
          bullet.style.bottom = `${bulletBottom + 5}px`;
        }

        const shipRect = ship.getBoundingClientRect();
        const bulletRect = bullet.getBoundingClientRect();
        if (
          bulletRect.left < shipRect.right &&
          bulletRect.right > shipRect.left &&
          bulletRect.top < shipRect.bottom &&
          bulletRect.bottom > shipRect.top
        ) {
          clearInterval(moveBullet);
          bullet.remove();
          endGame();
        }
      }, 20);
    }

    // Depth charges
    function createDepthCharge(x) {
      if (activeDepthCharges >= depthChargeLimit) return;
      activeDepthCharges++;
      const charge = document.createElement("div");
      charge.style.position = "absolute";
      charge.style.width = "10px";
      charge.style.height = "10px";
      charge.style.backgroundColor = "gray";
      charge.style.left = `${x}px`;

      // Since the ship is at the top, we'll drop from the ship's bottom edge
      charge.style.top = "50px";
      gameContainer.appendChild(charge);

      const moveCharge = setInterval(() => {
        if (gameOver) {
          clearInterval(moveCharge);
          charge.remove();
          return;
        }
        const chargeTop = parseInt(charge.style.top);
        // If it goes below the container bottom
        if (chargeTop >= 600) {
          clearInterval(moveCharge);
          charge.remove();
          activeDepthCharges--;
        } else {
          // Move down from top to bottom
          charge.style.top = `${chargeTop + 5}px`;
        }

        // Check collision with each submarine
        document.querySelectorAll("div").forEach((sub) => {
          if (sub === charge || sub === ship || !sub.dataset.direction) return;
          const subRect = sub.getBoundingClientRect();
          const chargeRect = charge.getBoundingClientRect();
          if (
            chargeRect.left < subRect.right &&
            chargeRect.right > subRect.left &&
            chargeRect.top < subRect.bottom &&
            chargeRect.bottom > subRect.top
          ) {
            clearInterval(moveCharge);
            charge.remove();
            sub.remove();
            activeDepthCharges--;
            score++;
            scoreDisplay.textContent = `Score: ${score}`;
          }
        });
      }, 20);
    }

    // End the game
    function endGame() {
      gameOver = true;
      alert(`Game Over! Final Score: ${score}`);
      location.reload();
    }

    // Ship controls
    document.addEventListener("keydown", (e) => {
      if (gameOver) return;
      const shipLeft = parseInt(ship.style.left);
      if (e.key === "ArrowLeft" && shipLeft > 0) {
        ship.style.left = `${shipLeft - shipSpeed}px`;
      } else if (e.key === "ArrowRight" && shipLeft < 750) {
        ship.style.left = `${shipLeft + shipSpeed}px`;
      } else if (e.key === " ") {
        createDepthCharge(shipLeft + 30);
      }
    });

    // Periodically spawn more submarines
    setInterval(() => {
      if (!gameOver) {
        createSubmarine();
        subSpawnInterval = Math.max(subSpawnInterval - 1000, 5000);
      }
    }, subSpawnInterval);

    // Start with an initial submarine
    createSubmarine();
  </script>
</body>
</html>
